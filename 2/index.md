---
layout: default
title: DOM & AJAX
---

{::options auto_ids="false" /}

[ГЛАВНАЯ](/)

# 2 DOM & AJAX
{: id="2"}

**ВНИМАНИЕ! РАЗДЕЛ НАХОДИТСЯ В СТАДИИ РАЗРАБОТКИ.**

Содержание:

2.1. [Работа с DOM, Events](#2.1)

2.1.1 [Полезные ресурсы](#2.1.1)\\
2.1.2 [Смешанное занятие](#2.1.2)\\
2.1.3 [Домашнее задание](#2.1.3)\\
2.1.4 [Техническое задание](#2.1.4)
{:.toc}

2.2 [Сетевое взаимодествие](#2.2)

2.2.1 [Полезные ресурсы](#2.2.1)\\
2.2.2 [Смешанное занятие](#2.2.2)\\
2.2.3 [Домашнее задание](#2.2.3)\\
2.2.4 [Техническое задание](#2.2.4)
{:.toc}

2.3 [Хранение данных на клиенте](#2.3)

2.3.1 [Полезные ресурсы](#2.3.1)\\
2.3.2 [Смешанное занятие](#2.3.2)\\
2.3.3 [Домашнее задание](#2.3.3)\\
2.3.4 [Техническое задание](#2.3.4)
{:.toc}

## 2.1 Работа с DOM, Events
{: id="2.1"}

### 2.1.1 Полезные ресурсы
{: id="2.1.1"}

1. Mozilla Developer Network. [Document Object Model (DOM)](https://developer.mozilla.org/en/docs/DOM).
2. W3C. [Document Object Model Events](http://www.w3.org/TR/DOM-Level-2-Events/events.html).
3. Илья Кантор. [Современный учебник JavaScript](http://learn.javascript.ru) // 2013.
4. [JSONP](http://www.json-p.org).


### 2.1.2 Смешанное занятие
{: id="2.1.2"}

### 2.1.3 Домашнее задание
{: id="2.1.3"}

1. Реализация игровой механики (на протяжении последующих домашних заданий в этом модуле).
2. Задействовать механизм publish–subscribe и реализовать ViewManager в соответствии с техническим заданием.

### 2.1.4 Техническое задание
{: id="2.1.4"}

1. Модернизировать используемые `View` так, чтобы у каждого представления был свой элемент в DOM. Другими словами, отрисовывать (метод `render()`) представление необходимо всего один раз, а методы`show()` и `hide()` использовать для управления видимостью элемента, который содержит отрисованное представление.
2. Необходимо создать представление `ViewManager` и организовать его работу следующим образом:
    1. Добавить зависимость `ViewManager` в роутер.
    2. Каждый `View` должен бросать событие `show` во время вызова метода `show()`, на которое будет подписываться `ViewManager`.
    3. Роутер должен информировать `ViewManager` об используемых `View`, а `ViewMagaer` подписываться на событие `show` новых представлений.
    4. В роутере для показа `View` необходимо использовать метод `show()` соотвествующего представления.
    5. Роутер не должен управлять скрытием остальных представлений (то есть вызовы метода `hide()` представлений в роутере должны отсутствовать).
    6. Обработка события `show` представлений в `ViewManager` заключается в том, чтобы скрыть все известные ему представления за исключением представления, которое породило это событие.

Таким образом, у нас должен получится гибкий механизм управления экранами. Когда нам необходимо показать какой-нибудь экран, мы просто вызываем метод `show()` у соотвествующего представления, а все остальные представления за нас скроет `ViewManager`.

## 2.2 Сетевое взаимодествие
{: id="2.2"}

### 2.2.1 Полезные ресурсы
{: id="2.2.1"}

1. Википедия. [List of HTTP status codes](http://en.wikipedia.org/wiki/HTTP_status_code).
2. Mozilla Developer Network. [XMLHttpRequest](https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest).
3. Tiffany Brown. [Introduction to XMLHttpRequest Level 2](http://dev.opera.com/articles/view/xhr2/) // 2012.
3. Armin Ronacher. [Websockets 101](http://lucumr.pocoo.org/2012/9/24/websockets-101/) // 2012.
4. Malte Ubl, Eiji Kitamura. [Introducing WebSockets: Bringing Sockets to the Web](http://www.html5rocks.com/en/tutorials/websockets/basics/) // 2010.
5. Илья Кантор. [WebSocket](http://learn.javascript.ru/websockets).

### 2.2.2 Смешанное занятие
{: id="2.2.2"}

### 2.2.3 Домашнее задание
{: id="2.2.3"}

1. Наладить взаимодествие с сервером с помощью `AJAX`.
    1. Организовать хранение и обработку `Scores` на сервере (взять готовый сервер)
    2. Добавить форму ввода имени игрока с сохранением результатов на сервер

### 2.2.4 Техническое задание
{: id="2.2.4"}

1. Создать новый `view GameOver` на экране `Game`
    1. `View` должна содержать поле ввода имени игрока, кнопку сохранения и отображать переданный при инициализации счет игрока.
    2. `View GameOver` не имеет отдульного маршрута и отображатеся только через экран `Game`
    2. При [`сабмите формы`](http://learn.javascript.ru/forms-methods) создается [`модель score`](http://backbonejs.org/#Collection-create) с указанными в форме данными и добавляется в коллекцию scores и сохраняется на сервер
    3. На время сохранения форма блокируется
    4. При ошибке сохранения пользователю выводится ошибка и форма разблокируется
    5. После успешного сохранения форма разблокируется, сбрасывается и происходит переход на экран `Scoreboard`
2. Модифицировать экран `Scoreboard` для получения данных с сервера (топ 10, заданные через `?limit=N`)
    1. При отображении экрана происходит [`fetch`](http://backbonejs.org/#Collection-fetch) коллекции `scores`
    2. Во время загрузки пользователю отображается индикатор загрузки
    3. В случае ошибки загрузки пользователю отображается соответствующее сообщение с возможностью обновить экран
    4. В случае успешной загрузки отображается список

### 2.2.5 RESTful API
{: id="2.2.5"}

Серверное RESTful API для работы со Score.

1. `GET /scores`
    + Код `200` — возвращает всю коллкцию scores или первые x элементов (заданные через `?limit=N`) отсортированную по убыванию счета игрока
2. `GET /scores/:id`
    + Код `200` — возвращает модель с переданным id
    + Код `400` — не верные входные данные
    + Код `404` — модель с указанным id не найдена
3. `POST /scores`
    + Тело запроса: `{"name": "<name>", "score": <score>}`
    + Код `200` — возвращает id созданной модели
    + Код `400` — не верные входные данные
4. `DELETE /scores/:id`
    + Код `200` — удаляет модель с переданным id
    + Код `400` — не верные входные данные
    + Код `404` — модель с указанным id не найдена
5. `PUT /scores/:id`
    + Тело запроса: `{"id": <id>, "name": "<name>", "score": <score>}`
    + Код `200` — обновляет и возвращает модель с переданным id
    + Код `400` — не верные входные данные
    + Код `404` — модель с указанным id не найдена

## 2.3 Хранение данных на клиенте
{: id="2.3"}

### 2.3.1 Полезные ресурсы
{: id="2.3.1"}

1. Википедия. [HTTP cookie](http://ru.wikipedia.org/wiki/HTTP_cookie).
2. Илья Кантор. [Куки, document.cookie](http://learn.javascript.ru/cookie) // 2013.
3. Michael Mahemoff. [Client-Side Storage](http://www.html5rocks.com/en/tutorials/offline/storage) // 2010.

### 2.3.2 Смешанное занятие
{: id="2.3.2"}

### 2.3.3 Домашнее задание
{: id="2.3.3"}

1. Организовать хранение пользовательских настроек на клиенте. Сохранять результаты игры на клиенте, при остуствии связи с сервером.

### 2.3.4 Техническое задание
{: id="2.3.4"}

1. При возникновении серверных ошибок (5хх) в момент сохранения результатов игры или отсутствии сети, несохраненные на сервере данные должны помещаться в localStorage.
2. Необходимо предусмотреть одновременное хранение нескольких резульататов игры в localStorage.
3. При загрузке экрана ScoreBoard необходимо проверить наличие несохраненных на сервере результатов игры. Если такие данные в localStorage есть, тогда необходимо их отправить на сервер. Когда все данные из localStorage будут сохранены на сервере, следует обновить список игроков на экране с сервера.
